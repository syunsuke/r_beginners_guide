# 日常作業は、R Notebookで行う


実際のRによるデータ作業では、
その分析作業の流れ自体にも意味があり、
それらを一つ一つを形として残すことによって
作業の意味が分かり易くなります。

いままで、Rの作業はコンソールのプロンプトにコマンドを
入力し実行することで行うと説明してきました。
確かに、一つ一つのコマンド実行と、
その結果を見た上で、次のコマンドを何にするか決めて実行するという
インタラクティブな操作は行えます。
しかし、全体的な流れを俯瞰したり、
後からまとめて把握して検討したりというということには適していません。
また、全体をみて検討するだけならば、
一般的に、**スクリプト**を書く事によって、
複数コマンドを作業の流れの通りに記載し、
一気に実行する方法もありますが、この場合、
インタラクティブな操作ではありません。

そこで、Rの様にインタラクティブなデータ作業に適しているのが、**R Notebook** です。
この**ノート**というものを聞いたことが無い人がイメージするなら、
マイクロソフトのワードの文章を作っていて、
計算部分のみエクセルを埋め込んで実行できるようにしてあるという感じのものです。


## 作業の準備はプロジェクトからはじめる

RStudioで作業する場合、作業用のフォルダを用意して、
そこにプロジェクトを作る癖を付けましょう。
ノート等を扱う場合、作業の成果をファイルとして保存することになりますし、
データ分析作業は、取り込み用のCSVファイルを管理する事も多く、
ファイル読み込み等、ファイル間の位置関係に気を配る必要が多くあります。
そこで、コード内ではファイルパスとして相対パスを使えるように、
関連するファイルを同じディレクトリ内で管理することが重要になります。

では、新しいフォルダを用意してプロジェクトを作り、
そのプロジェクトでRStudioを開いてください。

## R Notebookを新規作成する

RStudioのメニューから、File > New File > R Notebook と辿って選択して下さい。
RStudioの左側が一つのペインになったはずです。（図\@ref(fig:rnote001)）


```{r rnote001, echo=FALSE, out.width="80%", fig.cap="R Notebookを新規作成"}
knitr::include_graphics("images/rnote001.png")
```

但し、よく見ると、一番下にConsoleのペインが
小さく縮んでいるのが分かります。
各ペインの右上にある二つのアイコンを操作することによって、
各ペインは伸び縮させることができます。
ですから、コンソールが必要になったときは、それらアイコンを使ってConsoleペインを復元すればOKです。

この今、新しく開いたペインが R Notebook の編集領域です。
この部分はメモ帳と同じでカーソルを好きな所に動かして、
なんでも好きな事を書くことが出来ます。

英語がたくさん書かれていますが、
この殆どはプログラムのコードではありません。
内容は、R Notebook の簡単な使い方の説明ですが、
今は、特に気にしなくて結構です。
また、ここに書かれている文書は、**編集して消してしまっても、全然平気**です。
R Notebookを新規作成すれば、いつでも同じものが出てきます。

## R Notebookの構造

R Notebookを使いこなすには、まず、R Notebookの構造を覚えなければなりません。


### 設定を行うYAMLヘッダ

ファイルの先頭に注目してください。

```{r eval=FALSE}
---
title: "R Notebook"
output: html_notebook
---
```

R Notebookの先頭には必ず、この形式の表記があります。
この部分を**YAMLヘッダ**（YAMLはヤムルと読みます）と呼びます。
YAMLは、データ記述方法の一つで、
`---`に囲まれた部分に、あるルールに基づいてデータを記載する方法で、
R Notebook では、ここにそのノートのための設定を記載します。
しかし、R Notebook を触り始める時には、
この部分に何を書くのかを覚えるのではなく、
まず、ファイル先頭の`---`に囲まれた部分が、**YAMLヘッダ**であるということを
把握すれば十分です。

### チャンクでコードを実行

真ん中あたりに
```` ```{r}````と```` ``` ````に挟まれた部分があります。
このような部分を**チャンク**と呼びます。
チャンクはよく見ると、ほかの部分と少し色が変わっています。
また、右端に歯車、下三角、右三角の小さなアイコンがあります。（図\@ref(fig:chunk001)）


```{r chunk001, echo=FALSE, out.width="80%", fig.cap="チャンク"}
knitr::include_graphics("images/chunk001.png")
```

このチャンクにコマンドを書いて、右端の右三角アイコンをクリックすると、
チャンク内のコマンドが実行され、チャンクのすぐ下に結果が出力されます。
試しに、右三角アイコンをクリックしてみてください。carsデータに関する散布図が描画されます。

### それ以外の部分

YAMLヘッダとチャンク以外の部分は、
メモ帳に字を書いているのと同じです。
ですから、この部分に、コードに関するメモを書くことが出来ます。




